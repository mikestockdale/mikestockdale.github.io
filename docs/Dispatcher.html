<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>1.3.8&nbsp;Dispatcher</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="mystyle.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Wandering around writing software</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="Robot_World.html" class="tocviewselflink" data-pltdoc="x">Robot World</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>1&nbsp;</td><td><a href="Robot_World.html" class="tocviewlink" data-pltdoc="x">Robot World</a></td></tr></table><div class="tocviewsublist" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">1.1&nbsp;</td><td><a href="Shared.html" class="tocviewlink" data-pltdoc="x">Shared</a></td></tr><tr><td align="right">1.2&nbsp;</td><td><a href="Client.html" class="tocviewlink" data-pltdoc="x">Client</a></td></tr><tr><td align="right">1.3&nbsp;</td><td><a href="Server.html" class="tocviewselflink" data-pltdoc="x">Server</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_2&quot;);">&#9660;</a></td><td>1.3&nbsp;</td><td><a href="Server.html" class="tocviewlink" data-pltdoc="x">Server</a></td></tr></table><div class="tocviewsublistbottom" style="display: block;" id="tocview_2"><table cellspacing="0" cellpadding="0"><tr><td align="right">1.3.1&nbsp;</td><td><a href="Sequence.html" class="tocviewlink" data-pltdoc="x">Sequence</a></td></tr><tr><td align="right">1.3.2&nbsp;</td><td><a href="Cargos.html" class="tocviewlink" data-pltdoc="x">Cargos</a></td></tr><tr><td align="right">1.3.3&nbsp;</td><td><a href="Grid.html" class="tocviewlink" data-pltdoc="x">Grid</a></td></tr><tr><td align="right">1.3.4&nbsp;</td><td><a href="Engine.html" class="tocviewlink" data-pltdoc="x">Engine</a></td></tr><tr><td align="right">1.3.5&nbsp;</td><td><a href="Setup.html" class="tocviewlink" data-pltdoc="x">Setup</a></td></tr><tr><td align="right">1.3.6&nbsp;</td><td><a href="Agent.html" class="tocviewlink" data-pltdoc="x">Agent</a></td></tr><tr><td align="right">1.3.7&nbsp;</td><td><a href="Interval.html" class="tocviewlink" data-pltdoc="x">Interval</a></td></tr><tr><td align="right">1.3.8&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Dispatcher</a></td></tr><tr><td align="right">1.3.9&nbsp;</td><td><a href="TCP_Server.html" class="tocviewlink" data-pltdoc="x">TCP Server</a></td></tr></table></div></div></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">8.14</span></div><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="Interval.html" title="backward to &quot;1.3.7 Interval&quot;" data-pltdoc="x" rel="prev">&larr; prev</a>&nbsp;&nbsp;<a href="Server.html" title="up to &quot;1.3 Server&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="TCP_Server.html" title="forward to &quot;1.3.9 TCP Server&quot;" data-pltdoc="x" rel="next">next &rarr;</a></span>&nbsp;</div><h5 class="heading">1.3.8<tt>&nbsp;</tt><a name="(part._.Dispatcher)"></a>Dispatcher<span class="button-group"><a href="#(part._.Dispatcher)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h5><p><span class="versionbox"></span></p><p><div class="SIntrapara"><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>Source code at <a href="https://github.com/mikestockdale/robot-world/blob/main/server/dispatcher.rkt">dispatcher.rkt</a></p></blockquote></blockquote></blockquote></div><div class="SIntrapara">The dispatcher takes requests from clients and executes the appropriate procedures on the server.
It uses an agent to validate the requests, an engine to perform the requested actions and an interval to schedule their execution.</div></p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">struct</span><span class="hspace">&nbsp;</span><span class="RktSym">dispatcher</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">engine</span><span class="hspace">&nbsp;</span><span class="RktSym">agent</span><span class="hspace">&nbsp;</span><span class="RktSym">interval</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-dispatcher</span><span class="hspace">&nbsp;</span><span class="RktSym">engine</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">dispatcher</span><span class="hspace">&nbsp;</span><span class="RktSym">engine</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-agent</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-interval</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>A draw request returns a list of information for drawing entities.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">test-case:</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktVal">"execute draw"</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">let</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">engine</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-engine</span><span class="hspace">&nbsp;</span><span class="RktVal">50</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">check-equal?</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">execute-request</span><span class="hspace">&nbsp;</span><span class="RktSym">engine</span><span class="hspace">&nbsp;</span><span class="RktSym">request-draw</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">"nothing to draw"</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">add-entity</span><span class="hspace">&nbsp;</span><span class="RktSym">engine</span><span class="hspace">&nbsp;</span><span class="RktSym">type-block</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">location</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">check-equal?</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">length</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">execute-request</span><span class="hspace">&nbsp;</span><span class="RktSym">engine</span><span class="hspace">&nbsp;</span><span class="RktSym">request-draw</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">"one entity drawn"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>The engine procedure for drawing is executed.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">execute-request</span><span class="hspace">&nbsp;</span><span class="RktSym">engine</span><span class="hspace">&nbsp;</span><span class="RktSym">request</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cond</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">equal?</span><span class="hspace">&nbsp;</span><span class="RktSym">request</span><span class="hspace">&nbsp;</span><span class="RktSym">request-draw</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">draw-entities</span><span class="hspace">&nbsp;</span><span class="RktSym">engine</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">equal?</span><span class="hspace">&nbsp;</span><span class="RktSym">request</span><span class="hspace">&nbsp;</span><span class="RktSym">request-hello</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">execute-hello</span><span class="hspace">&nbsp;</span><span class="RktSym">engine</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">else</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">dispatch-list</span><span class="hspace">&nbsp;</span><span class="RktSym">engine</span><span class="hspace">&nbsp;</span><span class="RktSym">request</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>A hello request returns a list of new bots assigned to the client.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">test-case:</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktVal">"execute hello"</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">let</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">reply</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">execute-request</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-engine</span><span class="hspace">&nbsp;</span><span class="RktVal">50</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">request-hello</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">check-true</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">andmap</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">item</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">equal?</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">entity-type</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">reply-entity</span><span class="hspace">&nbsp;</span><span class="RktSym">item</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">type-bot</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">reply</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">"returns new bots"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>A hello request executes a procedure to set up bots.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">execute-hello</span><span class="hspace">&nbsp;</span><span class="RktSym">engine</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">map</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">entity</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">make-reply</span><span class="hspace">&nbsp;</span><span class="RktVal">#t</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">entity-id</span><span class="hspace">&nbsp;</span><span class="RktSym">entity</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">engine</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">setup-bots</span><span class="hspace">&nbsp;</span><span class="RktSym">engine</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">make-reply</span><span class="hspace">&nbsp;</span><span class="RktSym">success?</span><span class="hspace">&nbsp;</span><span class="RktSym">entity-id</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">engine</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">let-values</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">entity</span><span class="hspace">&nbsp;</span><span class="RktSym">cargo</span><span class="hspace">&nbsp;</span><span class="RktSym">neighbors</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">entity-info</span><span class="hspace">&nbsp;</span><span class="RktSym">engine</span><span class="hspace">&nbsp;</span><span class="RktSym">entity-id</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">reply</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">if</span><span class="hspace">&nbsp;</span><span class="RktSym">success?</span><span class="hspace">&nbsp;</span><span class="RktVal">#t</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">entity</span><span class="hspace">&nbsp;</span><span class="RktSym">cargo</span><span class="hspace">&nbsp;</span><span class="RktSym">neighbors</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>A list of commands returns bot information for each command.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">test-case:</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktVal">"requests from player"</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">let*</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">engine</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-engine</span><span class="hspace">&nbsp;</span><span class="RktVal">50</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">bot1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">add-entity</span><span class="hspace">&nbsp;</span><span class="RktSym">engine</span><span class="hspace">&nbsp;</span><span class="RktSym">type-bot</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">location</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">check-equal?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">execute-request</span><span class="hspace">&nbsp;</span><span class="RktSym">engine</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">request</span><span class="hspace">&nbsp;</span><span class="RktSym">request-move</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">entity-id</span><span class="hspace">&nbsp;</span><span class="RktSym">bot1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">direction-east</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">reply</span><span class="hspace">&nbsp;</span><span class="RktVal">#t</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">entity</span><span class="hspace">&nbsp;</span><span class="RktVal">101</span><span class="hspace">&nbsp;</span><span class="RktSym">type-bot</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">location</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>The engine procedure to be executed is accessed from a vector, based on the request type.</p><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">player-procedures</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">vector</span><span class="hspace">&nbsp;</span><span class="RktSym">drop-entity</span><span class="hspace">&nbsp;</span><span class="RktSym">move-entity</span><span class="hspace">&nbsp;</span><span class="RktSym">take-entity</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">dispatch-list</span><span class="hspace">&nbsp;</span><span class="RktSym">engine</span><span class="hspace">&nbsp;</span><span class="RktSym">request-list</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">execute</span><span class="hspace">&nbsp;</span><span class="RktSym">request</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">let*</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">procedure</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">vector-ref</span><span class="hspace">&nbsp;</span><span class="RktSym">player-procedures</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">request-type</span><span class="hspace">&nbsp;</span><span class="RktSym">request</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">response</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">procedure</span><span class="hspace">&nbsp;</span><span class="RktSym">engine</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">request-id</span><span class="hspace">&nbsp;</span><span class="RktSym">request</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">request-parameter</span><span class="hspace">&nbsp;</span><span class="RktSym">request</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-reply</span><span class="hspace">&nbsp;</span><span class="RktSym">response</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">request-id</span><span class="hspace">&nbsp;</span><span class="RktSym">request</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">map</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-reply</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-reply</span><span class="hspace">&nbsp;</span><span class="RktSym">engine</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">map</span><span class="hspace">&nbsp;</span><span class="RktSym">execute</span><span class="hspace">&nbsp;</span><span class="RktSym">request-list</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>When the dispatcher <span style="font-weight: bold">dispatch</span>es a <span style="font-weight: bold">request</span>, an invalid request returns an error message.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">test-case:</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktVal">"invalid request"</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">check-equal?</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">dispatch-request</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-dispatcher</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-engine</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">#f</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">"invalid request"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>The dispatcher delays execution to limit the rate of execution for each client.
If the agent matches the request, it is executed.
Otherwise, a message is returned.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">dispatch-request</span><span class="hspace">&nbsp;</span><span class="RktSym">dispatcher</span><span class="hspace">&nbsp;</span><span class="RktSym">request</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">dispatcher-interval</span><span class="hspace">&nbsp;</span><span class="RktSym">dispatcher</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">if</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">match-request</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">dispatcher-agent</span><span class="hspace">&nbsp;</span><span class="RktSym">dispatcher</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">request</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">execute-request</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">dispatcher-engine</span><span class="hspace">&nbsp;</span><span class="RktSym">dispatcher</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">request</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">"invalid request"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="Interval.html" title="backward to &quot;1.3.7 Interval&quot;" data-pltdoc="x" rel="prev">&larr; prev</a>&nbsp;&nbsp;<a href="Server.html" title="up to &quot;1.3 Server&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="TCP_Server.html" title="forward to &quot;1.3.9 TCP Server&quot;" data-pltdoc="x" rel="next">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>